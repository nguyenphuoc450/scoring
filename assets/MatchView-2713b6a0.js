import{_ as L,k as j,u as z,j as f,f as F,l as G,r as w,o as c,c as u,d as _,w as h,a as o,F as y,g as m,b as H,e as C,t as v,n as J,p as X,m as $,M as q}from"./index-c528173a.js";import{u as K}from"./index-8877e8d0.js";const D=k=>(X("data-v-70829c68"),k=k(),$(),k),A={class:"page"},Q={class:"form-players"},W={for:""},Y={class:"input-group__control"},Z={class:"form-players"},ee={for:""},te={class:"input-group__control"},oe={class:"table"},ae=D(()=>o("th",null," # ",-1)),ne={style:{display:"flex","flex-direction":"column","grid-gap":"4px"}},se=D(()=>o("th",null," Nút ",-1)),le={style:{display:"flex","grid-gap":"16px","justify-content":"center"}},ce={__name:"MatchView",setup(k){const N=j(),g=z(),x=f(!1),b=f(!1),l=f([]),S=f(null);f([]);const r=F(()=>{const t=N.params.id;return g.getters.getMatchById(t)}),I=()=>{l.value=l.value.map(t=>({...t,score:null}))},T=()=>{x.value=!0},B=()=>{x.value=!1,I()},V=()=>{const t={id:K(),info:l.value.map(a=>({...a,score:a.score||0,player_id:a.id}))},n={...r.value,rounds:[...r.value.rounds,t]};g.dispatch("updateMatchById",n),B()},O=t=>{b.value=!0,l.value=l.value.map(n=>{const d=r.value.rounds.find(s=>s.id===t).info.find(s=>s.player_id===n.id).score||0;return{...n,score:d}}),S.value=t},R=()=>{b.value=!1,I(),S.value=null},E=()=>{const t=[...r.value.rounds],n=t.findIndex(a=>a.id===S.value);if(n!==-1){const a=t[n].info.map(e=>{const i=l.value.find(p=>p.id===e.player_id).score||0;return{...e,score:i}}),d={...t[n],info:[...a]};t.splice(n,1,d);const s={...r.value,rounds:[...t]};g.dispatch("updateMatchById",s),R()}},P=(t,n)=>{q.confirm({title:"Xóa ván "+(n+1),content:"Bạn có muốn xóa không?",okText:"Ok",cancelText:"Không",onOk(){const a=r.value.rounds.filter(s=>s.id!==t),d={...r.value,rounds:[...a]};g.dispatch("updateMatchById",d)},onCancel(){}})};return G(()=>r.value,t=>{if(t){const n=JSON.parse(JSON.stringify(r.value));l.value=[...n.players];const a=[...n.rounds],d=l.value.map(s=>{const e=[];a.forEach(p=>{const M=p.info.find(U=>U.player_id===s.id);e.push(M)});const i=e.reduce((p,M)=>p+=M.score,0);return{...s,totalScore:i}});l.value=d}},{immediate:!0,deep:!0}),(t,n)=>{const a=w("a-button"),d=w("a-input-number"),s=w("a-modal");return c(),u("div",A,[_(a,{style:{display:"block",margin:"0 auto"},type:"primary",size:"large",onClick:T},{default:h(()=>[C(" Ghi điểm ")]),_:1}),_(s,{visible:x.value,title:"Ghi điểm",okText:"Tạo",cancelText:"Hủy",onOk:V,onCancel:B},{default:h(()=>[o("div",Q,[(c(!0),u(y,null,m(l.value,e=>(c(),u("div",{class:"input-group",key:e.id},[o("label",W,v(e.name),1),o("div",Y,[_(d,{value:e.score,"onUpdate:value":i=>e.score=i,placeholder:"Nhập"},null,8,["value","onUpdate:value"])])]))),128))])]),_:1},8,["visible"]),_(s,{visible:b.value,title:"Sửa điểm",okText:"Lưu",cancelText:"Hủy",onOk:E,onCancel:R},{default:h(()=>[o("div",Z,[(c(!0),u(y,null,m(l.value,e=>(c(),u("div",{class:"input-group",key:e.id},[o("label",ee,v(e.name),1),o("div",te,[_(d,{value:e.score,"onUpdate:value":i=>e.score=i,placeholder:"Nhập"},null,8,["value","onUpdate:value"])])]))),128))])]),_:1},8,["visible"]),o("table",oe,[o("thead",null,[o("tr",null,[ae,(c(!0),u(y,null,m(l.value,e=>(c(),u("th",{key:e.id},[o("div",ne,[o("span",null,v(e.name),1),o("span",{style:J({color:e.totalScore<0?"#ff4d4f":e.totalScore>0?"#52c41a":"#000000d9"})}," ("+v(e.totalScore)+") ",5)])]))),128)),se])]),o("tbody",null,[(c(!0),u(y,null,m(H(r).rounds,(e,i)=>(c(),u("tr",{key:e.id},[o("td",null,v(i+1),1),(c(!0),u(y,null,m(e.info,p=>(c(),u("td",{key:p.id},v(p.score),1))),128)),o("td",null,[o("div",le,[_(a,{type:"primary",onClick:p=>O(e.id)},{default:h(()=>[C(" Sửa ")]),_:2},1032,["onClick"]),_(a,{type:"danger",onClick:p=>P(e.id,i)},{default:h(()=>[C(" Xóa ")]),_:2},1032,["onClick"])])])]))),128))])])])}}},de=L(ce,[["__scopeId","data-v-70829c68"]]);export{de as default};
